const oEncodeJson = require('./json/oEncode')
const oEncode = oEncodeJson.data
const get_pinyin_chinese = (str) =>{
    let aChars = str.split('');
    let result = []; // 用于保存结果
    let sPre = ''; // 用于保存连续非汉字
    let sUChar;
    let sPinyin;
    for(let i = 0,  l = aChars.length; i < l; i++) {
        if(aChars[i] === ' ') {
            continue;
        }
        const copyChar = aChars[i]
        sUChar = window.escape(aChars[i]).replace('%u', '');
        sPinyin = oEncode[sUChar];

        // 存在则保存拼音，不存在则原样返回
        if(sPinyin) {
            if(sPre !== '') {
                const reg = /[a-z]+[012345]?/g
                if (reg.test(sPre)) {
                    const t = sPre.match(reg)
                    t.forEach(i => {
                        result.push({
                            pinyin: i,
                            context: ''
                        })
                    })
                } else {
                    result.push({
                        pinyin: '',
                        context: sPre
                    });
                }
                sPre = '';
            }

            sPinyin = sPinyin.replace(/\d+/g, '').split(' ')[0];
            sPinyin = window.unescape(sPinyin)
            result.push({
                'pinyin': '',
                'context': copyChar
            });
        } else {
            sPre += aChars[i];
        }
    }


    if(sPre !== '') {
        result.push(sPre);
    }

    return result;
}

module.exports = get_pinyin_chinese